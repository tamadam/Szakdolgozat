{% extends 'base_new.html' %}
{% load static %}
{% block content %}

<style type="text/css">

@font-face {
font-family: 'Kanit-Regular';
src: local('Kanit-Regular'),
url("{% static 'fonts/Kanit-Regular.ttf' %}");
}

@font-face {
	font-family: 'Kanit-Bold';
	src: local('Kanit-Bold'),
	url("{% static 'fonts/Kanit-Bold.ttf' %}");
}

@font-face {
	font-family: 'Kanit-Light';
	src: local('Kanit-Light'),
	url("{% static 'fonts/Kanit-Light.ttf' %}");
}


/* SCROLLBAR BEÁLLÍTÁSOK */

/* width */
::-webkit-scrollbar {
    width: 10px;;
}

/* Track */
::-webkit-scrollbar-track {
    background-color: darkgrey;
}
 
/* Handle */
::-webkit-scrollbar-thumb {
	box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);

}

/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
  background: #555; 
}


#characters-list {
	display: block;
}	

#characters-list p{
	font-size: 20px;
	display: inline-block;

}

#teams-list {
	display: none;
}

#teams-list p{
	display: inline-block;
}



#user-under-investigation:hover{
	color: red;
	cursor: pointer;

}


#team-paragh:hover{
	color: red;
	cursor: pointer;
}



#display-search-users-page{
	background: url("{% static 'images/hall-background.png' %}");	
	background-position: center;
	background-repeat: no-repeat;
	background-size: cover;
	background-color: white;

	width: 100%;
	height: 100%;
	display: flex;
	flex-direction: column;
	align-items: center;
	max-width: 1900px;
}

#search-users-title{
	height: 20%;
	width: 100%;
	display: flex;
	flex-direction: row;
	font-family: "Kanit-Regular";
	font-size: 2vh;
}


#search-users-title-left{
	width: 14%;
}

#search-users-title-center{
	width: 72%;
	display: flex;
	align-items: center;
	justify-content: center;
	text-align: center;

}

#search-users-title-right{
	width: 14%;
}



#main-page-button {
	display: flex;
	justify-content: center;
	align-items: center; 
	width: 100%;
	height: 100%;

}

#main-page-button img{
	width: 40%;
	height: 40;
	max-width: 100%;
	max-height: 100%;

}




.go-to-main-page:active {
	content:url("{% static 'images/previous-button-purple.png' %}");
}



#users-container{
	height: 60%;
	width: 50%;
	display: flex;
	flex-direction: column;
}


#footer{
	height: 20%;
	width: 100%;
	display: flex;
	align-items: center;
	justify-content: center;
}

.switch-button{
  font-size: 1.8vh;
  position: relative;
  display: inline-block;
  width: 5em;
  height: 2em;
}

.switch-button input{
  opacity: 0;
  width: 0;
  height: 0;
}


.slider{
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: lightgray;
  transition: 0.4s;
  border-radius: 30px;

}


.slider:before{
  position: absolute;
  content: "";
  height: 1.4em;
  width: 1.4em;
  border-radius: 20px;
  left: 0.3em;
  bottom: 0.3em;
  background-color: white;
  transition: 0.4s;
}

input:checked + .slider {
  background-color: green;
}


input:checked + .slider:before {
  transform: translateX(3.0em);
}



#users-header{
	height: 4%;
	overflow-y: scroll;

	display: flex;
	flex-direction: row;
}

#users{
	height: 92%;
	width: 100%;
	overflow-y: scroll;
	background-color: yellow;
}

#users-footer{
	height: 4%;
}


#teams-container{
	height: 60%;
	width: 50%;
	display: none;
	flex-direction: column;
}

#teams-header{
	height: 4%;
	overflow-y: scroll;

	display: flex;
	flex-direction: row;
}

#teams{
	height: 92%;
	width: 100%;
	overflow-y: scroll;
	background-color: yellow;
}

#teams-footer{
	height: 4%;
}



#users-header-rank{
	width: 10%;
	background-color: grey;
	display: flex;
	align-items: center;
	justify-content: center;
}

#users-header-character-type{
	width: 20%;
	background-color: yellow;
	display: flex;
	align-items: center;
	justify-content: center;	
}

#users-header-username{
	width: 20%;
	background-color: red;
	display: flex;
	align-items: center;
	justify-content: center;	
}

#users-header-team{
	width: 20%;
	background-color: orange;
	display: flex;
	align-items: center;
	justify-content: center;	
}

#users-header-level{
	width: 12%;
	background-color: green;
	display: flex;
	align-items: center;
	justify-content: center;	
}

#users-header-honor{
	width: 18%;
	background-color: blue;
	display: flex;
	align-items: center;
	justify-content: center;	
}



.user-div-paginate {
	background-color: lightblue;
	min-height: 50px;
	max-height: 80px;
	border-bottom: 2px solid black;
	display: flex;
	flex-direction: row;
	width: 100%;


}

.user-div-paginate:hover{
	cursor: pointer;
}

.rank-field{
	width: 10%;
	background-color: grey;
	display: flex;
	align-items: center;
	justify-content: center;
}


.character-type-field{
	width: 20%;
	background-color: yellow;
	display: flex;
	align-items: center;
	justify-content: center;
}

.character-type-field-img{
	max-width: 100%;
	max-height: 100%;
}

.username-field{
	width: 20%;
	background-color: red;
	display: flex;

	align-items: center;
	justify-content: center;
}

.user-team-field{
	width: 20%;
	background-color: orange;
	display: flex;
	align-items: center;
	justify-content: center;
}

.level-field{
	width: 12%;
	background-color: green;
	display: flex;
	align-items: center;
	justify-content: center;
}

.honor-field{
	width: 18%;
	background-color: blue;
	display: flex;
	align-items: center;
	justify-content: center;
}


.user-div-paginate-team {
	background-color: lightblue;
	min-height: 50px;
	max-height: 80px;
	border-bottom: 2px solid black;
	display: flex;
	flex-direction: row;
	width: 100%;


}

.user-div-paginate-team:hover{
	cursor: pointer;
}


.rank-field-team{
	width: 10%;
	background-color: grey;
	display: flex;
	align-items: center;
	justify-content: center;
}


.character-type-field-team{
	width: 20%;
	background-color: yellow;
	display: flex;
	align-items: center;
	justify-content: center;
}

.character-type-field-img-team{
	max-width: 100%;
	max-height: 100%;
}

.username-field-team{
	width: 40%;
	background-color: red;
	display: flex;
	align-items: center;
	justify-content: center;
}

.level-field-team{
	width: 12%;
	background-color: green;
	display: flex;
	align-items: center;
	justify-content: center;
}



.loader-container {
	width: 100%;
	height: 100%;
	position: absolute;
	top: 0;
	left: 0;
	background-color: black;
	display: flex;
	justify-content: center;
	align-items: center;
	z-index: 10;
	color: white;
	font-family: "Kanit-Regular";
	font-size: 1.8vh;

}




</style>


<div id="display-search-users-page">
	<div id="search-users-title">
		<div id="search-users-title-left">
			<div id="main-page-button">
				<img src="{% static 'images/previous-button.png' %}" alt="Vissza" class="go-to-main-page" onmouseover="changeColor(this)" onmouseout="resetColor(this)">
			</div>
		</div>
		<div id="search-users-title-center">
			<h1>Hősök csarnoka</h1>
		</div>
		<div id="search-users-title-right">	
		</div>		
	</div>
	<div id="users-container">
		<div id="users-header">
			<div id="users-header-rank">Helyezés</div>
			<div id="users-header-character-type">Karakter típus</div>
			<div id="users-header-username">Karakter név</div>
			<div id="users-header-team">Csapat</div>
			<div id="users-header-level">Szint</div>
			<div id="users-header-honor">Becsületpont</div>
		</div>
		<div id="users">

			
		</div>
		<div id="users-footer">
			<!--Footer-->		
		</div>
	</div>
	<div id="teams-container">
		<div id="teams-header">
			
		</div>
		<div id="teams">
			
		</div>
		<div id="teams-footer">
			Footer
		</div>
	</div>
	<div id="footer">
		<label class="switch-button">
			<input type="checkbox" id="switch-checkbox">
			<span class="slider"></span>
		</label>

	</div>
	<!--
	<div id="rework">

		<button id="characters-button" onclick="hideAndUnhide('showCharacters')">Karakterek</button>
		<button id="teams-button" onclick="hideAndUnhide('showTeams')">Csapatok</button>
		<div id="characters-list">
			<h1>Characters</h1>
			<h3>Név, ID, Szint, Becsületpont</h3>
			{% for character in characters %}

			<p id="user-under-investigation" onclick="selectUser('{{character.account.id}}')">{{character}}-{{character.account.id}}
			{{character.level}}-{{character.honor}}</p><br>
			
			{% endfor %}
		</div>
		<div id="teams-list">

			<p>Csapatok</p>
			{% for team in teams %}
				<h3><p id="team-paragh" onclick="selectTeam('{{team.id}}')">{{team.name}}</p></h3>
			{% endfor %}
		</div>

	</div>
	-->


	<div class="loader-container">
	</div>


</div>


<script type="text/javascript">


	$("#switch-checkbox").change(function(){
		$("#switch-checkbox").attr("disabled", true)
		audio.play()
		if ($(this).is(":checked")){
			//$("#users-container").css("display", "none")
			//$("#teams-container").css("display", "flex")
			$("#users-container").fadeOut("fast", function(){
				$("#users-container").css("display", "none")
				$("#teams-container").fadeIn("fast")
				$("#teams-container").css("display", "flex")
			})
		}
		else{
			//$("#teams-container").css("display", "none")
			//$("#users-container").css("display", "flex")
			$("#teams-container").fadeOut("fast", function(){
				$("#teams-container").css("display", "none")
				$("#users-container").fadeIn("fast")
				$("#users-container").css("display", "flex")
			})
		}
		// gyors nyomkodasnal voltak kisebb bugok, ezt kiiktatjuk azzal, hogy disable-jük a checkboxot és 400ms utan engedélyezzuk ujra
		setTimeout(function(){
			$("#switch-checkbox").removeAttr("disabled")
		}, 400)
	})


	const audio = new Audio()
	audio.src = "{% static 'audios/button_click.mp3' %}"


	var usersPageNumber = 1
	var teamsPageNumber = 1

	$(window).on("load", function(){
		loadNextPartOfUsers()
		loadNextPartOfTeams()


		setTimeout(function(){
			$(".loader-container").fadeOut("slow")
		}, 150)

	})




	$(".go-to-main-page").click(function(){
    	audio.play()

    	setTimeout(function(){
	    	try {

				var url = "{% url 'home_page' %}"
				var win = window.location.replace(url) 
				win.focus()
			}
			catch(error){
				console.log(error)
			}

    	}, 200)
    	$(".loader-container").fadeIn("fast")
	})


	function changeColor(imageElement){
		imageElement.setAttribute("src", "{% static 'images/previous-button-red.png' %}")
	}

	function resetColor(imageElement){
		imageElement.setAttribute("src", "{% static 'images/previous-button.png' %}")
	}




	function setPageNumber(pageNumber, loadedAllUsers){ // loadedAllMessages igaz, hogyha betöltötte az összes üzenetet és már nincs mit lekérdezni
		if (loadedAllUsers){
			usersPageNumber = -1
		}
		else {
			usersPageNumber = pageNumber
		}

		//document.getElementById("id_page_number").innerHTML = publicChatPageNumber
		console.log(usersPageNumber)
	}



	function setTeamsPageNumber(pageNumber, loadedAllTeams){ 
		if (loadedAllTeams){
			teamsPageNumber = -1
		}
		else {
			teamsPageNumber = pageNumber
		}
		console.log("pageNumber " + pageNumber)
		console.log("teamspagenumber ", teamsPageNumber)
	}





	function loadNextPartOfUsers(){
		let pageNumber = usersPageNumber
		if (pageNumber != -1){
			setPageNumber(-1, false)
			sendLoadNewUsers(pageNumber)
		}
	}

	function loadNextPartOfTeams(){
		console.log("loadNextPartOfTeams")
		let pageNumber = teamsPageNumber
		if (pageNumber != -1){
			setTeamsPageNumber(-1, false)
			console.log("send new team")
			sendLoadNewTeams(pageNumber)
		}
	}



	function sendLoadNewTeams(pageNumber){
		console.log('sendLoadNewTeams')
		payload = {
			"csrfmiddlewaretoken": "{{csrf_token}}",
			"page_number": pageNumber,

		}
		$.ajax({
			dataType: "json",
			url: "{% url 'core:load_teams_pagination' %}",
			data: payload,

			success: function(data) {
				console.log("SUCCESS-TEAMS")
				console.log(data.teams + data.load_page_number)
				handle_load_teams(data.teams, data.load_page_number)

			},
			error: function(data) {
				console.log('ERROR')
			},
		})
	}


	function sendLoadNewUsers(pageNumber){
		console.log('sendLoadNewUsers')
		payload = {
			"csrfmiddlewaretoken": "{{csrf_token}}",
			"page_number": pageNumber,

		}
		$.ajax({
			dataType: "json",
			url: "{% url 'core:load_users_pagination' %}",
			data: payload,

			success: function(data) {
				console.log("SUCCESS-USERS")
				//console.log(data.users + data.load_page_number)
				handle_load_users(data.users, data.load_page_number)

			},
			error: function(data) {
				console.log('ERROR')
			},
		})
	}


	function handle_load_users(users, loadPageNumber){
		if(users != null && users != "undefined" && users != "None"){
			setPageNumber(loadPageNumber, false)
			users.forEach(function(user){
				console.log(user)
				appendUserList(user)
			})
		}
		else{
			setPageNumber(-1, true)
		}
	}


	function handle_load_teams(teams, loadPageNumber){
		console.log("handle_load_teams + loadPageNumber " + loadPageNumber)
		if(teams != null && teams != "undefined" && teams != "None"){
			console.log("handle_load_teams true")
			setTeamsPageNumber(loadPageNumber, false)
			teams.forEach(function(team){
				console.log(team)
				appendTeamList(team)
			})
		}
		else{
			console.log("handle_load_teams false")
			setPageNumber(-1, true)
		}
	}




	function appendUserList(user){
		userID = user.id
		username = user.account
		characterType = user.character_type
		level = user.level
		honor = user.honor
		team = user.team
		rank = user.rank

		createUserElement(userID, username, characterType, level, honor, team, rank)
	}


	function appendTeamList(team){
		teamID = team.id
		teamName = team.name
		teamDescription = team.description
		teamMembersNum = team.members_number

		createTeamElement(teamID, teamName, teamDescription, teamMembersNum)
	}



	function createUserElement(userID, username, characterType, level, honor, team, rank){
		var usersListDiv = document.getElementById("users")
		console.log("uiserID " + userID)

		var newUserDiv = document.createElement("div")
		newUserDiv.classList.add("user-div-paginate")
		newUserDiv.addEventListener("click", function (event) {
			selectUser(userID)
		})


		var rankField = document.createElement("div")
		rankField.classList.add("rank-field")

		var rankFieldSpan = document.createElement("span")
		rankFieldSpan.innerHTML = rank



		rankField.appendChild(rankFieldSpan)

		var characterTypeField = document.createElement("div")
		characterTypeField.classList.add("character-type-field")

		var characterTypeFieldImg = document.createElement("img")
		if (characterType == "warrior"){
			characterTypeFieldImg.src = "{% static 'images/swordsman.png' %}"
		}
		else if (characterType == "mage"){
			characterTypeFieldImg.src = "{% static 'images/wizard.png' %}"
		}
		else if(characterType == "scout"){
			characterTypeFieldImg.src = "{% static 'images/archer.png' %}"
		}
		else{
			characterTypeFieldImg.src = "{% static 'images/swordsman.png' %}"
		}

		characterTypeFieldImg.classList.add("character-type-field-img")

		characterTypeField.appendChild(characterTypeFieldImg)

		var usernameField = document.createElement("div")
		//usernameField.innerHTML = username
		usernameField.classList.add("username-field")

		var usernameFieldSpan = document.createElement("span")
		usernameFieldSpan.innerHTML = username

		usernameField.appendChild(usernameFieldSpan)


		var userTeamField = document.createElement("div")
		userTeamField.classList.add("user-team-field")

		var userTeamSpan = document.createElement("span")
		userTeamSpan.innerHTML = team

		userTeamField.appendChild(userTeamSpan)


		var levelField = document.createElement("div")
		levelField.classList.add("level-field")

		var levelFieldSpan = document.createElement("span")
		levelFieldSpan.innerHTML = level

		levelField.appendChild(levelFieldSpan)

		var honorField = document.createElement("div")
		honorField.classList.add("honor-field")


		var honorFieldSpan = document.createElement("span")
		honorFieldSpan.innerHTML = honor

		honorField.appendChild(honorFieldSpan)

		newUserDiv.appendChild(rankField)
		newUserDiv.appendChild(characterTypeField)
		newUserDiv.appendChild(usernameField)
		newUserDiv.appendChild(userTeamField)
		newUserDiv.appendChild(levelField)
		newUserDiv.appendChild(honorField)

		usersListDiv.appendChild(newUserDiv)

	}

	var teamRankCounter = 1

	function createTeamElement(teamID, teamName, teamDescription, teamMembersNum){
		console.log(teamID, teamName, teamDescription)

		var teamsListDiv = document.getElementById("teams")

		var newTeamDiv = document.createElement("div")
		newTeamDiv.classList.add("user-div-paginate-team")
		newTeamDiv.addEventListener("click", function(event){
			selectTeam(teamID)
		})

		teamsListDiv.appendChild(newTeamDiv)

		var rankField = document.createElement("div")
		rankField.classList.add("rank-field-team")

		var rankFieldSpan = document.createElement("span")
		rankFieldSpan.innerHTML = teamRankCounter
		teamRankCounter++

		rankField.appendChild(rankFieldSpan)

		var characterTypeField = document.createElement("div")
		characterTypeField.classList.add("character-type-field-team")

		var characterTypeFieldImg = document.createElement("img")
		characterTypeFieldImg.src = "{% static 'images/team-icon.png' %}"
		characterTypeFieldImg.classList.add("character-type-field-img-team")

		characterTypeField.appendChild(characterTypeFieldImg)

		var usernameField = document.createElement("div")
		//usernameField.innerHTML = username
		usernameField.classList.add("username-field-team")

		var usernameFieldSpan = document.createElement("span")
		usernameFieldSpan.innerHTML = teamName

		usernameField.appendChild(usernameFieldSpan)


		var levelField = document.createElement("div")
		levelField.classList.add("level-field-team")

		var levelFieldSpan = document.createElement("span")
		levelFieldSpan.innerHTML = teamMembersNum

		levelField.appendChild(levelFieldSpan)


		newTeamDiv.appendChild(rankField)
		newTeamDiv.appendChild(characterTypeField)
		newTeamDiv.appendChild(usernameField)
		newTeamDiv.appendChild(levelField)

		teamsListDiv.appendChild(newTeamDiv)
	}





	$("#users").scroll(function(){
		var div = document.getElementById("users")
		if ((Math.abs(div.scrollTop) + 2) >= (div.scrollHeight - div.offsetHeight)) {
			loadNextPartOfUsers()
		}
	})


	$("#teams").scroll(function(){
		var div = document.getElementById("teams")
		if ((Math.abs(div.scrollTop) + 2) >= (div.scrollHeight - div.offsetHeight)) {
			loadNextPartOfTeams()
		}
	})




	function selectTeam(teamId){
		var url = "{% url 'team:individual_team_view' team_id=7347328438423 %}".replace("7347328438423", teamId);
		var win = window.open(url, "_self")
		win.focus()
	}

	function selectUser(userId){
	var url = "{% url 'profile' user_id=7347328438423 %}".replace("7347328438423", userId);
	var win = window.open(url, "_self")
	win.focus()
	}

</script>


{% endblock %}